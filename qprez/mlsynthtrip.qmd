---
title: "No Layovers, No Reservations: Productionizing Synthetic Controls for Tripadvisor Using [mlsynth](https://jgreathouse9.github.io/mlsynth/webdir/mlsynthlanding.html)"
subtitle: Python-native, production-ready synthetic control methods
author:
  - name: "Jared Greathouse"
    url: "https://jgreathouse9.github.io"
date: today
format:
  revealjs:
    theme: sky
    slide-number: true
    transition: fade
    scrollable: true
    footer: "Tripadvisor Â· mlsynth"
highlight-style: github
---

## Executive Summary

- **The problem**: Synthetic Control Methods (SCMs) are critical for Tripadvisorâ€™s geo-testing and policy evaluation but are slowed by technical debt:
  - Fragmented tools across R or Python
  - Inconsistent syntax and manual processes
  - Not production-ready for scalable workflows
- **The solution**: `mlsynth` â€” a lightweight Python library unifying over 20 SCMs under one consistent grammar, easily integrated with Tripadvisorâ€™s preference for Python.
- **The impact**:
  - Run multiple SCMs in <3 minutes with <50 lines of code
  - Seamlessly integrate into CI/CD pipelines for automated geo-testing
  - Enable faster, scalable insights for ad campaigns and tourism policies
- **Tripadvisor benefit**: Transition from R to Python, aligning with your teamâ€™s expertise and production needs.

---

::: {.panel-tabset}

## What Are SCMs?

Synthetic Control Methods (SCMs) estimate causal effects by creating a weighted average of untreated units, ideal for:

- Geo-testing ad campaigns across markets

- Evaluating tourism policies (e.g., pricing, regulations)

**Tripadvisor use case**: Measure the impact of marketing campaigns or policy changes (e.g., hotel pricing) with precision.

## Practical Problems

Several advances that Tripadvisor may benefit from have non-trivial adoption barriers. The first barrier is purely software: not all useful methods are offered in one software, and fragmentation makes integerating different estimators into a single workflow difficult.

| Estimator | Language | Challenges |
|-----------|----------|------------|
| [Forward DID](https://doi.org/10.1287/mksc.2022.0212) | R | Free, but requires extensive user input |
| [Forward SCM](https://doi.org/10.1016/j.econlet.2024.111976) | Stata | Not free, not streamlined |
| [Two-Step SCM](https://doi.org/10.1287/mnsc.2023.4878) | Matlab | Not free, not streamlined |
| [Robust PCA Synth](https://academicworks.cuny.edu/gc_etds/4984/) | R + Python | Requires two languages |

:::

---

## Practical Problems cont.

Beyond simple software constraints, SCM tools often fail to:

- ðŸ›‘ Support multiple methods in one workflow
- ðŸ“Š Provide automated diagnostics or effect-size statistics
- ðŸ”„ Facilitate easy comparison between methods

**Tripadvisor impact**: Manual/ad-hoc processes in R slow geo-testing for ad campaigns, delaying insights for campaign optimization.

---

## Practical Solutions

A streamlined SCM workflow for Tripadvisor should include:

- **Input**: A simple table with unit, time, treatment, and outcome
- **Method**: A single `.fit()` call for all computations
- **Output**: Effect estimates + diagnostics (e.g., fit quality, robustness)

**Tripadvisor benefit**: Enables rapid geo-testing across markets and policy evaluations with consistent, automated results.

---

## Traveling Lightly: Enter `mlsynth`

`mlsynth` is a lightweight Python library designed to:

- Unify multiple SCMs under one consistent grammar
- Integrate seamlessly into Github Actions or CI/CD pipelines
- Transition Tripadvisorâ€™s R-based SCM workflows to Python, aligning with in-house expertise

**Result**: Analysts focus on insights for ad campaigns and policies, not software logistics.

---

## Why use `mlsynth`?

- **For Tripadvisorâ€™s analysts**:
  - Quick onboarding with one syntax
  - Extensible design to add new and bespoke SCMs
  - Transparent results for easy validation
- **For Tripadvisorâ€™s organization**:
  - Production-ready workflows for geo-testing
  - Faster analysis, reducing campaign optimization time
  - Lower technical debt by eliminating R dependencies
- **For Tripadvisorâ€™s leadership**:
  - Scalable insights for ad campaigns and policy evaluations
  - Cost savings from streamlined tools and automation

---

## Empirical Example: [Barcelona Hotel Moratorium](https://doi.org/10.1080/13504851.2021.1927958)

- **Intervention**: City-wide hotel building moratorium (June 2015)
- **Outcome**: Normalized hotel prices (from Booking.com)
- **Donors**: 83 cities (16 Mediterranean)
- **Pre-treatment period**: 224 weeks (2011 Week 1â€“2015 July)
- **Objective**: Estimate causal effect on hotel prices
- **Tripadvisor relevance**: Mirrors evaluating tourism policies or marketing impacts on bookings

**With `mlsynth`**: Estimated three SCMs in less than 3 minutes with <30 lines of code, showing a ~12% price increase.

---

## Simple Syntax

This code estimates three SCMs using a unified syntax, ready for CI/CD integration.

```{python}
#| echo: true
import pandas as pd
from mlsynth import FSCM, CLUSTERSC, PDA

# Load public tourism dataset
url = "https://raw.githubusercontent.com/jgreathouse9/GSUmetricspolicy/refs/heads/main/data/RawData/hotelex.csv"
data = pd.read_csv(url)

# Configure inputs (unit, time, treatment, outcome)
config = {
    "df": data,
    "outcome": "indexed_price",
    "treat": "treat",
    "unitid": "fullname",
    "time": "time",
    "display_graphs": False
}

# Fit Forward SCM
arco = FSCM(config).fit()
y_obs = arco.sub_method_results['FSCM'].time_series.observed_outcome
y_FSCM = arco.sub_method_results['FSCM'].time_series.counterfactual_outcome
T0 = arco.raw_results['Fit']['Pre-Periods']

# Fit PDA (L2 method)
config_pda = dict(config)
config_pda["method"] = "l2"
l2pda = PDA(config_pda).fit()
y_l2relaxed = l2pda.time_series.model_extra['synthetic_outcome']

# Fit Robust SCM
config_RSC = dict(config)
config_RSC["method"], config_RSC["cluster"] = "PCR", False
RSC = CLUSTERSC(config_RSC).fit()
y_RSC = RSC.sub_method_results['PCR'].time_series.counterfactual_outcome
```

**Tripadvisor benefit**: Automate this pipeline for geo-testing or policy analysis.

---

## Plot of Predictions

This chart compares Barcelonaâ€™s observed hotel prices to three SCM counterfactuals, highlighting the moratoriumâ€™s ~12% price increase.

```{python}
import matplotlib.pyplot as plt
import numpy as np

# Flatten arrays (as in your original code)
y_obs_flat = np.ravel(y_obs)
y_FSCM_flat = np.ravel(y_FSCM)
y_l2relaxed_flat = np.ravel(y_l2relaxed)
y_PCR_flat = np.ravel(y_RSC)
time_index = np.arange(len(y_obs_flat))

# Create enhanced plot
plt.figure(figsize=(10, 6))
plt.plot(time_index, y_obs_flat, label="Barcelona (Observed)", color="#000000", linewidth=2.5)
plt.plot(time_index, y_FSCM_flat, label="Forward SCM", color="#1E90FF", linewidth=1.5)
plt.plot(time_index, y_l2relaxed_flat, label="PDA L2", color="#FFA500", linewidth=1.5)
plt.plot(time_index, y_PCR_flat, label="Robust SCM", color="#FF4500", linewidth=1.5)

# Mark treatment
plt.axvline(x=T0, color="#000000", linestyle="--", label="Hotel Moratorium", linewidth=1.5)
plt.text(T0 + 2, max(y_obs_flat) * 0.95, "Moratorium (~12% Increase)", fontsize=10, color="#000000")

# Styling
plt.xlabel("Time (Weeks)", fontsize=12)
plt.ylabel("Indexed Price", fontsize=12)
plt.title("SCM Estimates of Barcelona Hotel Prices (mlsynth)", fontsize=14, pad=10)
plt.legend(fontsize=10, loc="upper left")
plt.grid(True, linestyle="--", alpha=0.7)
plt.tight_layout()

plt.show()
```

---

## Why `mlsynth` is different

`mlsynth` estimated the Barcelona moratoriumâ€™s impact using one library with a few lines of code.

- **Before**: Manual R workflows, fragmented syntax, potentially hours of setup
- **After**: Unified Python syntax, automated diagnostics, results in minutes
- **Tripadvisor impact**: Scale geo-testing for ad campaigns and policy evaluations with minimal overhead.

::: {.callout-note}
Before/After: R-based manual workflows â†’ `mlsynth` automated pipelines
:::

---

## Key Takeaways

- `mlsynth` removes SCM barriers with a unified, Python-native grammar
- Enables Tripadvisor to scale geo-testing and policy evaluations, saving up to 50% analysis time
- Production-ready for CI/CD integration, aligning with Tripadvisorâ€™s Python expertise
- Extensible for future SCM methods and custom tools

**Next steps**: Partner with Jared Greathouse to:
- Select optimal SCM methods for Tripadvisorâ€™s use cases
- Productionize workflows with `mlsynth` and CI/CD
- Build a custom SCM tool with visualizations, collaborating with Tripadvisorâ€™s engineering/AI teams
- Contact: [jgreathouse9.github.io](https://jgreathouse9.github.io)
